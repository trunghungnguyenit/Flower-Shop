{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ACER/Desktop/Flower-Shop/app/api/order/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\n\r\n// Interface for simple order (from quick-order-section)\r\ninterface SimpleOrderData {\r\n  name: string;\r\n  phone: string;\r\n  flowerType: string;\r\n  note?: string;\r\n}\r\n\r\n// Interface for detailed order (from product-order-form)\r\ninterface DetailedOrderData {\r\n  // Th√¥ng tin kh√°ch h√†ng\r\n  name: string;\r\n  phone: string;\r\n  note?: string;\r\n  \r\n  // Th√¥ng tin s·∫£n ph·∫©m\r\n  productName: string;\r\n  productPrice: number;\r\n  quantity: number;\r\n  \r\n  // Th√¥ng tin giao h√†ng\r\n  senderAddress?: string;\r\n  receiverAddress: string;\r\n  deliveryTime?: string;\r\n  \r\n  // D·ªãch v·ª• th√™m\r\n  additionalServices: string[];\r\n  \r\n  // T·ªïng ti·ªÅn\r\n  totalAmount: number;\r\n}\r\n\r\ntype OrderData = SimpleOrderData | DetailedOrderData;\r\n\r\n// Type guard to check if it's a detailed order\r\nfunction isDetailedOrder(data: OrderData): data is DetailedOrderData {\r\n  return 'productName' in data && 'productPrice' in data;\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    // Parse request body\r\n    const body: OrderData = await request.json();\r\n    \r\n    // Validate required fields for both types\r\n    if (!body.name || !body.phone) {\r\n      return NextResponse.json(\r\n        { success: false, message: 'Thi·∫øu th√¥ng tin b·∫Øt bu·ªôc' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Additional validation for detailed orders\r\n    if (isDetailedOrder(body) && (!body.productName || !body.receiverAddress)) {\r\n      return NextResponse.json(\r\n        { success: false, message: 'Thi·∫øu th√¥ng tin s·∫£n ph·∫©m ho·∫∑c ƒë·ªãa ch·ªâ nh·∫≠n' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Additional validation for simple orders\r\n    if (!isDetailedOrder(body) && !body.flowerType) {\r\n      return NextResponse.json(\r\n        { success: false, message: 'Thi·∫øu th√¥ng tin lo·∫°i hoa' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Get Discord webhook URL from environment\r\n    const webhookUrl = process.env.DISCORD_WEBHOOK_URL;\r\n    if (!webhookUrl) {\r\n      return NextResponse.json(\r\n        { success: false, message: 'C·∫•u h√¨nh webhook kh√¥ng t·ªìn t·∫°i' },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    let discordMessage: string;\r\n\r\n    if (isDetailedOrder(body)) {\r\n      // Format detailed order message\r\n      const servicesText = body.additionalServices.length > 0 \r\n        ? body.additionalServices.join(', ') \r\n        : 'Kh√¥ng c√≥ d·ªãch v·ª• th√™m';\r\n\r\n      discordMessage = `üå∏ **ƒê∆†N ƒê·∫∂T HOA M·ªöI** üå∏\r\n\r\nüë§ **T√™n kh√°ch:** ${body.name}\r\nüì± **SƒêT:** ${body.phone}\r\nüå∫ **S·∫£n ph·∫©m:** ${body.productName}\r\nüí∞ **ƒê∆°n gi√°:** ${body.productPrice.toLocaleString('vi-VN')}ƒë\r\nüî¢ **S·ªë l∆∞·ª£ng:** ${body.quantity}\r\nüíµ **T·ªïng ti·ªÅn:** ${body.totalAmount.toLocaleString('vi-VN')}ƒë\r\n\r\nüìç **ƒê·ªãa ch·ªâ g·ª≠i:** ${body.senderAddress || 'C·ª≠a h√†ng'}\r\nüìç **ƒê·ªãa ch·ªâ nh·∫≠n:** ${body.receiverAddress}\r\n‚è∞ **Th·ªùi gian giao:** ${body.deliveryTime || 'Theo l·ªãch c·ª≠a h√†ng'}\r\n\r\nüéÅ **D·ªãch v·ª• th√™m:** ${servicesText}\r\nüìù **Ghi ch√∫:** ${body.note || 'Kh√¥ng c√≥ ghi ch√∫'}\r\n\r\n‚è∞ **Th·ªùi gian ƒë·∫∑t:** ${new Date().toLocaleString('vi-VN')}`;\r\n    } else {\r\n      // Format simple order message\r\n      discordMessage = `üå∏ **ƒê∆†N ƒê·∫∂T HOA M·ªöI** üå∏\r\n\r\nüë§ **T√™n kh√°ch:** ${body.name}\r\nüì± **SƒêT:** ${body.phone}\r\nüå∫ **Lo·∫°i hoa:** ${body.flowerType}\r\nüìù **Ghi ch√∫:** ${body.note || 'Kh√¥ng c√≥ ghi ch√∫'}\r\n\r\n‚è∞ **Th·ªùi gian ƒë·∫∑t:** ${new Date().toLocaleString('vi-VN')}`;\r\n    }\r\n\r\n    // Send to Discord webhook\r\n    const discordResponse = await fetch(webhookUrl, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        content: discordMessage,\r\n      }),\r\n    });\r\n\r\n    if (!discordResponse.ok) {\r\n      throw new Error('Kh√¥ng th·ªÉ g·ª≠i th√¥ng b√°o Discord');\r\n    }\r\n\r\n    return NextResponse.json({ success: true });\r\n\r\n  } catch (error) {\r\n    console.error('Order API Error:', error);\r\n    return NextResponse.json(\r\n      { success: false, message: 'C√≥ l·ªói x·∫£y ra khi x·ª≠ l√Ω ƒë∆°n h√†ng' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;;AAoCA,+CAA+C;AAC/C,SAAS,gBAAgB,IAAe;IACtC,OAAO,iBAAiB,QAAQ,kBAAkB;AACpD;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,qBAAqB;QACrB,MAAM,OAAkB,MAAM,QAAQ,IAAI;QAE1C,0CAA0C;QAC1C,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK,KAAK,EAAE;YAC7B,OAAO,yPAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAA2B,GACtD;gBAAE,QAAQ;YAAI;QAElB;QAEA,4CAA4C;QAC5C,IAAI,gBAAgB,SAAS,CAAC,CAAC,KAAK,WAAW,IAAI,CAAC,KAAK,eAAe,GAAG;YACzE,OAAO,yPAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAA6C,GACxE;gBAAE,QAAQ;YAAI;QAElB;QAEA,0CAA0C;QAC1C,IAAI,CAAC,gBAAgB,SAAS,CAAC,KAAK,UAAU,EAAE;YAC9C,OAAO,yPAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAA2B,GACtD;gBAAE,QAAQ;YAAI;QAElB;QAEA,2CAA2C;QAC3C,MAAM,aAAa,QAAQ,GAAG,CAAC,mBAAmB;QAClD,IAAI,CAAC,YAAY;YACf,OAAO,yPAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAAiC,GAC5D;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI;QAEJ,IAAI,gBAAgB,OAAO;YACzB,gCAAgC;YAChC,MAAM,eAAe,KAAK,kBAAkB,CAAC,MAAM,GAAG,IAClD,KAAK,kBAAkB,CAAC,IAAI,CAAC,QAC7B;YAEJ,iBAAiB,CAAC;;kBAEN,EAAE,KAAK,IAAI,CAAC;YAClB,EAAE,KAAK,KAAK,CAAC;iBACR,EAAE,KAAK,WAAW,CAAC;gBACpB,EAAE,KAAK,YAAY,CAAC,cAAc,CAAC,SAAS;iBAC3C,EAAE,KAAK,QAAQ,CAAC;kBACf,EAAE,KAAK,WAAW,CAAC,cAAc,CAAC,SAAS;;oBAEzC,EAAE,KAAK,aAAa,IAAI,WAAW;qBAClC,EAAE,KAAK,eAAe,CAAC;sBACtB,EAAE,KAAK,YAAY,IAAI,qBAAqB;;qBAE7C,EAAE,aAAa;gBACpB,EAAE,KAAK,IAAI,IAAI,mBAAmB;;qBAE7B,EAAE,IAAI,OAAO,cAAc,CAAC,UAAU;QACvD,OAAO;YACL,8BAA8B;YAC9B,iBAAiB,CAAC;;kBAEN,EAAE,KAAK,IAAI,CAAC;YAClB,EAAE,KAAK,KAAK,CAAC;iBACR,EAAE,KAAK,UAAU,CAAC;gBACnB,EAAE,KAAK,IAAI,IAAI,mBAAmB;;qBAE7B,EAAE,IAAI,OAAO,cAAc,CAAC,UAAU;QACvD;QAEA,0BAA0B;QAC1B,MAAM,kBAAkB,MAAM,MAAM,YAAY;YAC9C,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,SAAS;YACX;QACF;QAEA,IAAI,CAAC,gBAAgB,EAAE,EAAE;YACvB,MAAM,IAAI,MAAM;QAClB;QAEA,OAAO,yPAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAE3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,yPAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,SAAS;QAAmC,GAC9D;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}